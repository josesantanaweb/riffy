generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id             String          @id @default(cuid())
  email          String          @unique
  password       String
  name           String
  phone          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  role           Role            @default(OWNER)
  brandColor     String?         @default("#00D4FF")
  logo           String?
  status         UserStatus      @default(ACTIVE)
  instagram      String?
  tiktok         String?
  whatsapp       String?
  domain         String          @unique
  paymentMethods PaymentMethod[]
  bingos         Bingo[]
  notification   Notification[]
  planId         String?
  plan           Plan?           @relation(fields: [planId], references: [id])
  planUsage      PlanUsage?
}

model Plan {
  id          String      @id @default(cuid())
  name        String      @unique
  description String[]
  price       Float
  maxBingos   Int?        @default(0)
  maxBoards   Int?        @default(0)
  type        PlanType
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
  owners      User[]
  planUsages  PlanUsage[]
}

model Bingo {
  id           String   @id @default(cuid())
  title        String
  banner       String
  totalBoards  Int      @default(100)
  price        Float
  drawDate     DateTime @default(dbgenerated("(now() + '30 minutes'::interval)"))
  showDate     Boolean? @default(true)
  showProgress Boolean? @default(true)
  minBoards    Int?     @default(2)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  ownerId      String
  award        Float
  drawnNumbers Int[]

  status   BingoStatus @default(ACTIVE)
  owner    User        @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  boards   Board[]
  payments Payment[]
}

model Board {
  id            String      @id @default(cuid())
  number        Int
  numbers       Json
  markedNumbers Json?
  status        BoardStatus @default(AVAILABLE)
  bingoId       String
  paymentId     String?
  payment       Payment?    @relation(fields: [paymentId], references: [id], onDelete: SetNull)
  bingo         Bingo       @relation(fields: [bingoId], references: [id], onDelete: Cascade)

  @@unique([bingoId, number])
}

model Payment {
  id            String        @id @default(cuid())
  buyerName     String
  phone         String
  state         String?
  proofUrl      String
  paymentDate   DateTime?     @default(now())
  email         String?
  status        PaymentStatus @default(PENDING)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  paymentMethod String?
  nationalId    String?
  amount        Float?
  bingoId       String?
  bingo         Bingo?        @relation(fields: [bingoId], references: [id], onDelete: Cascade)
  boards        Board[]
}

model PaymentMethod {
  id          String            @id @default(cuid())
  name        String
  type        PaymentMethodType
  bankName    String?
  phoneNumber String?
  nationalId  String?
  binanceId   String?
  paypalEmail String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt
  ownerId     String
  owner       User              @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

model Notification {
  id          String             @id @default(cuid())
  description String
  status      NotificationStatus @default(UNREAD)
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  ownerId     String
  owner       User               @relation(fields: [ownerId], references: [id], onDelete: Cascade)
}

model PlanUsage {
  id            String          @id @default(cuid())
  ownerId       String          @unique
  planId        String
  currentBingos Int             @default(0)
  currentBoards Int             @default(0)
  status        PlanUsageStatus @default(ACTIVE)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  owner         User            @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  plan          Plan            @relation(fields: [planId], references: [id], onDelete: Cascade)
}

enum PlanType {
  BASIC
  PREMIUM
  ONE_TIME
}

enum NotificationStatus {
  READ
  UNREAD
}

enum PaymentStatus {
  PENDING
  VERIFIED
  DENIED
}

enum BingoStatus {
  ACTIVE
  PENDING
  COMPLETED
}

enum BoardStatus {
  AVAILABLE
  SOLD
  PREMIUM
  WINNER
  LOSER
}

enum UserStatus {
  ACTIVE
  INACTIVE
}

enum Role {
  ADMIN
  OWNER
}

enum PaymentMethodType {
  PAGO_MOVIL
  BINANCE_PAY
  PAYPAL
}

enum PlanUsageStatus {
  ACTIVE
  EXHAUSTED
  UNLIMITED
}
